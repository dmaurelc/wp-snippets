---
import Layout from '../../layouts/Layout.astro';
import { getAllSnippets, getSnippetBySlug } from '../../lib/api';

export async function getStaticPaths() {
  const snippets = await getAllSnippets();
  return snippets.map((snippet) => ({
    params: { slug: snippet.slug },
  }));
}

const { slug } = Astro.params;
const snippet = await getSnippetBySlug(slug);

if (!snippet) {
  return Astro.redirect('/404');
}
---

<Layout 
  title={`${snippet.title} - Code Snippets Blog`}
  description={snippet.acf_fields.resumen}
>
  <article class="max-w-4xl mx-auto px-4 py-8" data-pagefind-body>
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md overflow-hidden">
      {snippet.imagen_destacada && (
        <div class="w-full aspect-video">
          <img
            src={snippet.imagen_destacada}
            alt={snippet.title}
            class="w-full h-full object-cover"
            data-pagefind-meta="image"
          />
        </div>
      )}
      
      <div class="p-8">
        <header class="mb-8">
          <div class="flex flex-wrap gap-2 mb-4">
            {snippet.categorias.map((category) => (
              <span 
                class="px-3 py-1 text-sm bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-100 rounded-full"
                data-pagefind-filter="category"
              >
                {category}
              </span>
            ))}
          </div>
          <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4" data-pagefind-meta="title">
            {snippet.title}
          </h1>
          <p class="text-lg text-gray-600 dark:text-gray-300" data-pagefind-meta="description">
            {snippet.acf_fields.resumen}
          </p>
        </header>

        <div class="prose prose-lg max-w-none dark:prose-invert">
          {snippet.acf_fields.descripcion && (
            <div class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Description</h2>
              <div class="text-gray-600 dark:text-gray-300" set:html={snippet.acf_fields.descripcion} />
            </div>
          )}
          
          {snippet.acf_fields.codigo && (
            <div class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Code</h2>
              <div class="bg-[#282a36] rounded-lg overflow-hidden">
                <pre class="p-4 overflow-x-auto">
                  <code set:html={snippet.acf_fields.codigo} />
                </pre>
              </div>
            </div>
          )}
          
          {snippet.acf_fields.instrucciones && (
            <div class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Instructions</h2>
              <div class="text-gray-600 dark:text-gray-300" set:html={snippet.acf_fields.instrucciones} />
            </div>
          )}
          
          {snippet.acf_fields.galeria && snippet.acf_fields.galeria.length > 0 && (
            <div class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Gallery</h2>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                {snippet.acf_fields.galeria.map((imageUrl) => (
                  <div class="aspect-video rounded-lg overflow-hidden">
                    <img
                      src={imageUrl}
                      alt=""
                      class="w-full h-full object-cover"
                    />
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  </article>
</Layout>